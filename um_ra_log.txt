2015-9-15

Todo:
	1. 设计医生查询系统界面;
	2. 设计数据库；
	3. 根据数据库要求，设计model中的结构；
	4. 确定数据转换工具功能－－－－－－根据数据要求；
	5. 构建数据操作方式；

2015-9-16
	
	设计数据库

	doctor index:
	{"doctorid": "123456", "host": "10.119.180.43", "port":"27017", "database": "ehr", "collection": "doctorinfo"}

	patient index:

	{"patientid":"123456", "host":"10.119.180.43", "port":"27017","database":"ehr", "collection":"patientinfo"}

	流程

	1. 医生账户密码登录；

	2. center dbs －－－－> 根据doctor index table , 确定医生信息存储于哪个节点；

	3. 根据查询到的节点信息， 到相应的node 上验证密码的正确性；

	4. 验证成功，则医生登陆成功；否则，提示登录失败，重新登录；

	5. 查询－－－－－主要根据病人ID，获取病人的病例信息－－－－查询条件： ID，时间， 医院

	6. 获取病人授权－－－－－可以采用自主刷身份证的方式，然后系统自动获取病人的身份证ID，显示做保密处理；

	7. 根据patient ID， 查询 patient index table，确定病人信息在哪些node；

	8. 根据node信息，分别从各个节点上获取病人的信息；

	9. 当病人的病例信息从node传输时，根据privacy strategy, 自动处理病人的病例信息；

	10. 每次的查询操作都会被记录到log中；


doctor index collection:

doctorindex

{"doctorid": "11111111", "host": "10.119.180.43", "port":"27017", "database": "ehrprivacy", "collection": "doctorinfo"}
{"doctorid": "22222222", "host": "10.119.180.44", "port":"27017", "database": "ehrprivacy", "collection": "doctorinfo"}
{"doctorid": "33333333", "host": "10.119.180.45", "port":"27017", "database": "ehrprivacy", "collection": "doctorinfo"}
{"doctorid": "44444444", "host": "10.119.180.44", "port":"27017", "database": "ehrprivacy", "collection": "doctorinfo"}
{"doctorid": "55555555", "host": "10.119.180.43", "port":"27017", "database": "ehrprivacy", "collection": "doctorinfo"}


doctorinfo----need other informations

43:
{"doctorid":"11111111","password":"1111"}
{"doctorid":"55555555","password":"5555"}

44:
{"doctorid":"22222222","password":"2222"}
{"doctorid":"44444444","password":"4444"}
45:
{"doctorid":"33333333","password":"3333"}


Patient index table collection:

patientindex

{"patientid": "11111111", "host": "10.119.180.43", "port":"27017", "database": "ehrprivacy", "collection": "patientrecord"}

patientrecord:

{"patientid":"11111111",.............others informations}

PatientRecord: 病人病例的公共数据格式，包括三家医院病例的全部数据结构；

DoctorRole: 医生信息， 主要是 ID 和 权限 ，主要用于控制record中可以显示的内容。
q
key point :

 How to control doctor access the patient record?

 
2015-9-18

node1: hospitalId : 0001

node2: hospitalId : 0002

node3: hospitalId : 0003

"hospital_ID":"0001"
"hospital_ID":"0002"
"hospital_ID":"0003"


load data to all nodes;


Database :

	EhrPrivacy

	host: 

		42:
			collection:

				1. doctor index:   DoctorIndex

						{"doctor":{"Doctor_ID":"11111111","host":"10.119.180.43","port":"27017","database":"EhrPrivacy","collection":"Doctor"}}

						{"doctor":{"Doctor_ID":"11111111","host":"10.119.180.43","port":"27017","database":"EhrPrivacy","collection":"Doctor"}}

						{"doctor":{"Doctor_ID":"11111111","host":"10.119.180.43","port":"27017","database":"EhrPrivacy","collection":"Doctor"}}


				2. patient index:  PatientIndex

						{"patient":{"Patient_ID":"11828","host":"10.119.180.43","port":"27017","database":"EhrPrivacy","collection":"Patient"}}

						{"patient":{"Patient_ID":"11828","host":"10.119.180.44","port":"27017","database":"EhrPrivacy","collection":"Patient","recordcollection":"PatientRecords"}}
						{"patient":{"Patient_ID":"11828","host":"10.119.180.45","port":"27017","database":"EhrPrivacy","collection":"Patient","recordcollection":"PatientRecords"}}

				3. patient record index: PatientRecordIndex

						{"patient":{"Patient_ID":"11828","host":"10.119.180.44","port":"27017","database":"EhrPrivacy","recordcollection":"PatientRecords"}}






		43:
			collection:
				1.patient information: Patient
				2. clical detection:   ClinicalDetection
				3. examination:        Examination
				4. doctor information: Doctor

				{"doctor":{"Doctor_ID":"11111111","Name":"Jone","hospital_ID":"0001","Password":"1111"}}
				{"doctor":{"Doctor_ID":"55555555","Name":"Liu","hospital_ID":"0001","Password":"5555"}}

		44:
			collection:
				1.patient information: Patient
				2. clical detection:   ClinicalDetection
				3. examination:        Examination
				4. doctor information: Doctor
				
				{"doctor":{"Doctor_ID":"22222222","Name":"Kim","hospital_ID":"0002","Password":"2222"}}
				{"doctor":{"Doctor_ID":"44444444","Name":"Jim","hospital_ID":"0002","Password":"4444"}}


		45:
			collection:
				1.patient information: Patient
				2. clical detection:   ClinicalDetection
				3. examination:        Examination
				4. doctor information: Doctor

				{"doctor":{"Doctor_ID":"33333333","Name":"Lily","hospital_ID":"0003","Password":"3333"}}
				


sql server password:

	Software2014=-




2015-9-21
	
	load Data!!!

	1. Doctor information schema!
		.the role of doctor ----- control the privacy of patient records.

	2. Patient information schema!
		. Add the password of patient --- patient can login to query thire's records.

	2. Patient records schema!

patient info json

{"patient":{"IDCardNO":"","HospitalID":"","PatientName":"","HomeAddress":"","Sex":"","DateOfBirth":"","Nationality":"","BloodType":"","BloodTypeRH":""}}


patient record json

{"patientRecord":{"HospitalID":"","IDCardNO":"","HemodialysisChartRecordSet":{"Time":"","SystolicPressure":"","DiastolicPressure":"","Pulse":"","UF":"","Na":"","Temp":"","TMP":"","Ven":"","BloodFlow":""},"HemodialysisRecordSet":{"Date":"","Times":"","Machine":"","Dialyzer":"","BloodAccess":"","WeightPreD":"","DryWeight":"","TargetLoss":"","WeightPostD":"","DurationH":"","DurationM":"","Programme":"","KCI":"","NetLoss":"","DialysisBlockage":"","AntiCoagulation":"","AntiCoDosage":"","NSFlushVolume":"","RecommonDosage":"","VenoferDosage":"","DarbepoetinDosage":"","D3ZemplarDosage":"","GlucoseDosage":"","NSDosage":"","Hypotension":"","Hypertension":"","Arhythmia":"","Vomiting":"","Cramp":"","Comments":"","StartNurse":"","CheckNurse":"","CloseNurse":"","WithdrawalNurse":"","Doctor":""},"HBVaccineInjectionRecordSet":{"DateMonth0":"","DateMonth1":"","DateMonth2":"","DateMonth3":"","DateMonth4":"","DateMonth5":"","DateMonth6":"","DateMonth7":"","DateMonth8":"","DateMonth9":"","DateMonth10":""},"LaboratoryReportRecordSet":{"HB":"","HBsAg":"","AntiHBs":"","HBeAg":"","AntiHBe":"","AntiHCV":"","VDRL":""}}}




HospitalID:

	uh   gov   hw  

collection: PatientInfo

{"patient":{"IDCardNO":"73002","HospitalID":"hw","PatientName":"杨英英","HomeAddress":"贡士旦旬奴街","Sex":"M","DateOfBirth":""06/03/56,"Nationality":"东莞市","BloodType":"A","BloodTypeRH":"RH+"}}


collecton:  PatientRecords

{"patientRecord":
				{
					"HospitalID":"uh",

					"IDCardNO":"73002",

					"Date":"2013"

					"HemodialysisChartRecordSet":
													{
														"Time":"1",
														"SystolicPressure":"106-145",
														"DiastolicPressure":"70-90",
														"Pulse":"10bmp",
														"UF":"10L",
														"Na":"45mmol",
														"Temp":"39",
														"TMP":"105mmHg",
														"Ven":"134mmHg",
														"BloodFlow":"156ml/min"
													},

					"HemodialysisRecordSet":
													{
														"Date":"June 25, 2013",
														"Times":"2",
														"Machine":"B.Braun-Dialog",
														"Dialyzer":"Gambro 17L",
														"BloodAccess":"5.0",
														"WeightPreD":"45kg",
														"DryWeight":"45kg",
														"TargetLoss":"6L",
														"WeightPostD":"40kg",
														"DurationH":"16",
														"DurationM":"17",
														"Programme":"APD",
														"KCI":"145ml",
														"NetLoss":"145ml",
														"DialysisBlockage":"yes",
														"AntiCoagulation":"no",
														"AntiCoDosage":"145ml",
														"NSFlushVolume":"145ml",
														"RecommonDosage":"6KU",
														"VenoferDosage":"yes",
														"DarbepoetinDosage":"145mcg",
														"D3ZemplarDosage":"145mcg",
														"GlucoseDosage":"145ml",
														"NSDosage":"145ml",
														"Hypotension":"yes",
														"Hypertension":"no",
														"Arhythmia":"no",
														"Vomiting":"yes",
														"Cramp":"yes",
														"Comments":"Sodium bicarbonate;normal calcium with glucose",
														"StartNurse":"Tom",
														"CheckNurse":"Tom",
														"CloseNurse":"Tom",
														"WithdrawalNurse":"Tom",
														"Doctor":"Dr. Tom"
													},

					"HBVaccineInjectionRecordSet":
													{
														"DateMonth0":"14/06/2012",
														"DateMonth1":"14/07/2012",
														"DateMonth2":"14/08/2012",
														"DateMonth3":"",
														"DateMonth4":"",
														"DateMonth5":"",
														"DateMonth6":"14/12/2012",
														"DateMonth7":"14/01/2013",
														"DateMonth8":"14/02/2013",
														"DateMonth9":"14/03/2013",
														"DateMonth10":"14/04/2013"
													},

					"LaboratoryReportRecordSet":
													{
														"HB":"80.2g/L",
														"HBsAg":"Negative",
														"AntiHBs":"Positive",
														"HBeAg":"N/A",
														"AntiHBe":"N/A",
														"AntiHCV":"Positive",
														"VDRL":"Negative"
													}
					}
}



patient index collection: PatientIndex

{"patient":{"Patient_ID":"73002","host":"10.119.180.43","port":"27017","database":"EhrPrivacy","collection":"PatientInfo"}}
{"patient":{"Patient_ID":"73002","host":"10.119.180.44","port":"27017","database":"EhrPrivacy","collection":"PatientInfo"}}
{"patient":{"Patient_ID":"73002","host":"10.119.180.45","port":"27017","database":"EhrPrivacy","collection":"PatientInfo"}}


